<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DKWin9 Demo Platform</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #0f172a;
      color: #fff;
      margin: 0;
      padding: 0;
    }
    .app {
      text-align: center;
      padding: 20px;
    }
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .logout-btn {
      background: crimson;
      border: none;
      padding: 6px 12px;
      border-radius: 6px;
      cursor: pointer;
      color: white;
    }
    .auth-box,
    .bet-box,
    .recent-box {
      background: #1e293b;
      margin: 20px auto;
      padding: 20px;
      border-radius: 10px;
      max-width: 400px;
    }
    input {
      padding: 10px;
      border-radius: 6px;
      border: none;
      width: 80%;
      margin: 10px 0;
    }
    button {
      background: #2563eb;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 8px;
      margin: 5px;
      cursor: pointer;
    }
    button:disabled {
      background: gray;
      cursor: not-allowed;
    }
    .result {
      font-size: 1.2em;
      margin-top: 10px;
    }
    ul {
      list-style: none;
      padding: 0;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    // --- Storage utils ---
    const saveUser = (user) => localStorage.setItem("user", JSON.stringify(user));
    const getUser = () => JSON.parse(localStorage.getItem("user"));
    const logout = () => localStorage.removeItem("user");
    const saveResult = (res) => {
      const all = JSON.parse(localStorage.getItem("results") || "[]");
      all.push(res);
      localStorage.setItem("results", JSON.stringify(all));
    };
    const getResults = () => JSON.parse(localStorage.getItem("results") || "[]");

    // --- Auth Form ---
    function AuthForm({ onLogin }) {
      const [username, setUsername] = useState("");
      const handleSubmit = (e) => {
        e.preventDefault();
        if (!username.trim()) return alert("Enter username!");
        saveUser({ username });
        onLogin({ username });
      };
      return (
        <div className="auth-box">
          <h2>Login / Register</h2>
          <form onSubmit={handleSubmit}>
            <input
              placeholder="Enter Username"
              value={username}
              onChange={(e) => setUsername(e.target.value)}
            />
            <button type="submit">Enter Platform</button>
          </form>
        </div>
      );
    }

    // --- Bet Grid ---
    function BetGrid({ user }) {
      const [bet, setBet] = useState(null);
      const [result, setResult] = useState(null);
      const [loading, setLoading] = useState(false);

      const playRound = () => {
        setLoading(true);
        const rand = Math.floor(Math.random() * 10);
        const outcome = rand % 2 === 0 ? "EVEN" : "ODD";
        setTimeout(() => {
          setLoading(false);
          setResult(outcome);
          saveResult({ time: new Date().toLocaleTimeString(), num: rand, outcome });
        }, 1000);
      };

      return (
        <div className="bet-box">
          <h2>Hello {user.username} ðŸ‘‹</h2>
          <p>Select your bet and play!</p>
          <div className="buttons">
            <button onClick={() => setBet("EVEN")}>Even</button>
            <button onClick={() => setBet("ODD")}>Odd</button>
          </div>
          <button className="play-btn" disabled={!bet || loading} onClick={playRound}>
            {loading ? "Rolling..." : "Play Round"}
          </button>

          {result && (
            <p className="result">
              ðŸŽ‰ Result: <strong>{result}</strong>
            </p>
          )}
        </div>
      );
    }

    // --- Recent Results ---
    function RecentResults() {
      const [results, setResults] = useState([]);
      useEffect(() => setResults(getResults()), []);

      return (
        <div className="recent-box">
          <h3>Recent Results</h3>
          {results.length === 0 ? (
            <p>No games played yet.</p>
          ) : (
            <ul>
              {results.slice(-10).reverse().map((r, i) => (
                <li key={i}>
                  {r.time} â€” ðŸŽ² {r.num} â†’ {r.outcome}
                </li>
              ))}
            </ul>
          )}
        </div>
      );
    }

    // --- Main App ---
    function App() {
      const [user, setUser] = useState(getUser());
      useEffect(() => { document.title = "DKWin9 Demo Platform"; }, []);
      return (
        <div className="app">
          <header className="header">
            <h1>ðŸŽ¯ DKWin9 Local Demo</h1>
            {user && (
              <button className="logout-btn" onClick={() => { logout(); setUser(null); }}>
                Logout
              </button>
            )}
          </header>

          {!user ? (
            <AuthForm onLogin={setUser} />
          ) : (
            <>
              <BetGrid user={user} />
              <RecentResults />
            </>
          )}
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<App />);
  </script>
</body>
</html>
